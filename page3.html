<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>page3.html</title>
</head>
<body>
  <h1>位置情報によるページ分岐テスト</h1>
  <p>現在地を取得して、東京駅から半径500m以内かどうかを判定します。</p>

  <script>
    // === 東京駅の座標 ===
    // 後で別の場所に変更する場合はここを書き換えてください
    const targetLat = 35.681236; // 東京駅 緯度
    const targetLon = 139.767125; // 東京駅 経度

    // === 判定範囲 (m) ===
    // 後で変更可能
    const range = 500; // 半径500m

    // === リンク先URL ===
    // 後で変更する場合はここを書き換えてください
    const urlInside = "near.html"; // 範囲内のときのリンク先
    const urlOutside = "far.html"; // 範囲外のときのリンク先

    // 距離計算 (ハーヴァサイン公式)
    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // 地球の半径 (m)
      const toRad = x => x * Math.PI / 180;

      const φ1 = toRad(lat1);
      const φ2 = toRad(lat2);
      const Δφ = toRad(lat2 - lat1);
      const Δλ = toRad(lon2 - lon1);

      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

      return R * c; // 距離 (m)
    }

    // 位置情報取得と判定
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      const distance = getDistance(lat, lon, targetLat, targetLon);
      console.log("現在地:", lat, lon, "距離:", distance, "m");

      if (distance <= range) {
        window.location.href = urlInside;
      } else {
        window.location.href = urlOutside;
      }
    }, err => {
      alert("位置情報が取得できませんでした: " + err.message);
    });
  </script>
</body>
</html>
